<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Group Extractor v6.0.2</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <!-- ========================================
             HEADER
        ======================================== -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üë•</span>
                <h1>WA Extractor</h1>
            </div>
            <div class="header-actions">
                <button id="btnViewHistory" class="btn-icon-header" title="Ver Hist√≥rico (Ctrl+H)">
                    üìú
                </button>
                <span class="version">v6.0.2</span>
            </div>
        </header>

        <!-- ========================================
             BARRA DE STATUS
        ======================================== -->
        <div id="statusBar" class="status-bar hidden">
            <span id="statusText">Aguardando...</span>
            <div id="progressBar" class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
                <span class="progress-text" id="progressPercent">0%</span>
            </div>
            <!-- Controles de extra√ß√£o -->
            <div id="extractionControls" class="extraction-controls hidden">
                <button id="btnPauseExtraction" class="btn-control btn-control-pause" title="Pausar extra√ß√£o">
                    ‚è∏Ô∏è Pausar
                </button>
                <button id="btnResumeExtraction" class="btn-control btn-control-resume hidden" title="Continuar extra√ß√£o">
                    ‚ñ∂Ô∏è Continuar
                </button>
                <button id="btnStopExtraction" class="btn-control btn-control-stop" title="Parar extra√ß√£o">
                    ‚èπÔ∏è Parar
                </button>
            </div>
        </div>

        <!-- ========================================
             ETAPA 1: CARREGAR GRUPOS
        ======================================== -->
        <section id="step1" class="step">
            <p class="instruction">
                Carregue seus grupos do WhatsApp para come√ßar:
            </p>

            <button id="btnLoadGroups" class="btn btn-primary btn-large">
                <span class="btn-icon">üìÇ</span>
                Carregar Grupos
            </button>

            <div class="info-box">
                <span class="info-icon">‚ÑπÔ∏è</span>
                <span class="info-text">
                    Certifique-se de estar com o WhatsApp Web aberto
                </span>
            </div>

            <!-- Atalhos -->
            <div class="shortcuts-box">
                <p class="shortcuts-title">‚å®Ô∏è Atalhos:</p>
                <ul class="shortcuts-list">
                    <li><kbd>Ctrl+L</kbd> Carregar grupos</li>
                    <li><kbd>Ctrl+H</kbd> Ver hist√≥rico</li>
                    <li><kbd>Ctrl+F</kbd> Buscar grupo</li>
                </ul>
            </div>
        </section>

        <!-- ========================================
             ETAPA 2: SELECIONAR GRUPO
        ======================================== -->
        <section id="step2" class="step hidden">
            <div class="groups-header">
                <h2>Selecione um Grupo</h2>
                <span id="groupCount" class="badge">0 grupos</span>
            </div>

            <!-- Estat√≠sticas -->
            <div id="groupStats" class="group-stats">
                <div class="stat-item" id="statActive">
                    <span class="stat-icon">üí¨</span>
                    <span class="stat-value">0</span>
                    <span class="stat-label">ativos</span>
                </div>
                <div class="stat-item" id="statArchived">
                    <span class="stat-icon">üì¶</span>
                    <span class="stat-value">0</span>
                    <span class="stat-label">arquivados</span>
                </div>
            </div>

            <!-- Filtros por abas -->
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">
                    <span class="tab-icon">üìã</span> Todos
                </button>
                <button class="filter-tab" data-filter="active">
                    <span class="tab-icon">üí¨</span> Ativos
                </button>
                <button class="filter-tab" data-filter="archived">
                    <span class="tab-icon">üì¶</span> Arquivados
                </button>
            </div>

            <!-- Campo de busca -->
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input 
                    type="text" 
                    id="searchGroups" 
                    placeholder="Filtrar grupos..." 
                    autocomplete="off" 
                />
            </div>

            <!-- Lista de grupos (Virtual Scroll) -->
            <div id="groupsList" class="groups-list">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando grupos...</p>
                </div>
            </div>

            <!-- A√ß√µes -->
            <div class="actions">
                <button id="btnBack" class="btn btn-secondary">
                    ‚Üê Voltar
                </button>
                <button id="btnExtract" class="btn btn-primary" disabled>
                    <span class="btn-icon">üì•</span>
                    Extrair Membros
                </button>
            </div>
        </section>

        <!-- ========================================
             ETAPA 3: RESULTADO
        ======================================== -->
        <section id="step3" class="step hidden">
            <div class="result-header">
                <span class="result-icon">‚úÖ</span>
                <h2>Extra√ß√£o Conclu√≠da!</h2>
            </div>

            <!-- Informa√ß√µes do resultado -->
            <div class="result-info">
                <div class="result-item">
                    <span class="label">Grupo:</span>
                    <span id="resultGroupName" class="value">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Status:</span>
                    <span id="resultGroupStatus" class="value">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Membros:</span>
                    <span id="resultMemberCount" class="value">-</span>
                </div>
            </div>

            <!-- Lista de membros extra√≠dos (Virtual Scroll) -->
            <div class="members-container">
                <h3 class="members-title">
                    <span class="members-icon">üë•</span>
                    Membros Extra√≠dos
                </h3>
                <div id="membersList" class="members-list">
                    <!-- Membros ser√£o inseridos aqui via Virtual Scroll -->
                </div>
            </div>

            <!-- Bot√µes de exporta√ß√£o -->
            <div class="export-buttons">
                <button id="btnExportCSV" class="btn btn-export" title="Exportar como CSV (Ctrl+S)">
                    üìÑ CSV
                </button>
                <button id="btnCopyList" class="btn btn-export" title="Copiar lista">
                    üìã Copiar
                </button>
            </div>

            <!-- Bot√µes Google Sheets -->
            <div class="sheets-buttons">
                <button id="btnCopySheets" class="btn btn-sheets" title="Copiar para Google Sheets (Ctrl+G)">
                    <span class="btn-icon">üìä</span> Copiar para Sheets
                </button>
                <button id="btnOpenSheets" class="btn btn-sheets-outline" title="Abrir no Google Sheets">
                    <span class="btn-icon">üîó</span> Abrir no Sheets
                </button>
            </div>

            <!-- Bot√£o nova extra√ß√£o -->
            <button id="btnNewExtraction" class="btn btn-secondary btn-large">
                üîÑ Nova Extra√ß√£o
            </button>
        </section>

        <!-- ========================================
             ETAPA 4: HIST√ìRICO
        ======================================== -->
        <section id="step4" class="step hidden">
            <div class="history-header">
                <h2>üìú Hist√≥rico de Extra√ß√µes</h2>
            </div>

            <!-- Estat√≠sticas do hist√≥rico -->
            <div id="historyStats" class="history-stats">
                <!-- Stats ser√£o inseridas dinamicamente -->
            </div>

            <!-- Lista do hist√≥rico -->
            <div id="historyList" class="history-list">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando hist√≥rico...</p>
                </div>
            </div>

            <!-- A√ß√µes do hist√≥rico -->
            <div class="actions">
                <button id="btnBackFromHistory" class="btn btn-secondary">
                    ‚Üê Voltar
                </button>
                <button id="btnClearHistory" class="btn btn-danger">
                    üóëÔ∏è Limpar Tudo
                </button>
            </div>
        </section>

        <!-- ========================================
             MENSAGEM DE ERRO
        ======================================== -->
        <div id="errorBox" class="error-box hidden">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span id="errorText" class="error-text">Erro desconhecido</span>
            <button id="btnDismissError" class="btn-dismiss" title="Fechar">
                ‚úï
            </button>
        </div>

        <!-- ========================================
             FOOTER
        ======================================== -->
        <footer class="footer">
            <span class="footer-text">
                WhatsApp Group Member Extractor
            </span>
        </footer>
    </div>

    <!-- ========================================
         SCRIPTS - SEM type="module"
    ======================================== -->
    <script src="utils/utils-optimized.js"></script>
    <script src="utils/storage.js"></script>
    <script src="utils/google-sheets-export.js"></script>
    <script src="popup.js"></script>
</body>
</html>