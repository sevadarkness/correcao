<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Group Extractor v6.0.6 - Side Panel</title>
    <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
    <div class="container">
        <!-- ========================================
             HEADER
        ======================================== -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üë•</span>
                <h1>WA Extractor</h1>
            </div>
            <div class="header-actions">
                <button id="btnViewCampaign" class="btn-icon-header" title="Envio em Massa">
                    üì¢
                </button>
                <button id="btnViewHistory" class="btn-icon-header" title="Ver Hist√≥rico (Ctrl+H)">
                    üìú
                </button>
                <span class="version">v6.1.0</span>
            </div>
        </header>



        <!-- ========================================
             BARRA DE STATUS
        ======================================== -->
        <div id="statusBar" class="status-bar hidden">
            <span id="statusText">Aguardando...</span>
            <div id="progressBar" class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
                <span class="progress-text" id="progressPercent">0%</span>
            </div>
            <!-- Controles de extra√ß√£o -->
            <div id="extractionControls" class="extraction-controls hidden">
                <button id="btnPauseExtraction" class="btn-control btn-control-pause" title="Pausar extra√ß√£o">
                    ‚è∏Ô∏è Pausar
                </button>
                <button id="btnResumeExtraction" class="btn-control btn-control-resume hidden" title="Continuar extra√ß√£o">
                    ‚ñ∂Ô∏è Continuar
                </button>
                <button id="btnStopExtraction" class="btn-control btn-control-stop" title="Parar extra√ß√£o">
                    ‚èπÔ∏è Parar
                </button>
            </div>
        </div>

        <!-- ========================================
             ETAPA 1: CARREGAR GRUPOS
        ======================================== -->
        <section id="step1" class="step">
            <!-- Bal√£o de dica -->
            <div class="tip-bubble" id="tipBubble">
                <div class="tip-content">
                    üí° Clique em <strong>"Carregar Grupos"</strong> para come√ßar!
                </div>
            </div>

            <button id="btnLoadGroups" class="btn btn-primary btn-large">
                <span class="btn-icon">üìÇ</span>
                Carregar Grupos
            </button>

            <!-- Atalhos -->
            <div class="shortcuts-box">
                <p class="shortcuts-title">‚å®Ô∏è Atalhos:</p>
                <ul class="shortcuts-list">
                    <li><kbd>Ctrl+L</kbd> Carregar grupos</li>
                    <li><kbd>Ctrl+H</kbd> Ver hist√≥rico</li>
                    <li><kbd>Ctrl+F</kbd> Buscar grupo</li>
                </ul>
            </div>
        </section>

        <!-- ========================================
             ETAPA 2: SELECIONAR GRUPO
        ======================================== -->
        <section id="step2" class="step hidden">
            <div class="groups-header">
                <h2>Selecione um Grupo</h2>
                <span id="groupCount" class="badge">0 grupos</span>
            </div>

            <!-- Estat√≠sticas -->
            <div id="groupStats" class="group-stats">
                <div class="stat-item" id="statTotal">
                    <span class="stat-icon">üìä</span>
                    <div class="stat-info">
                        <span class="stat-label">Total:</span>
                        <span class="stat-value">0</span>
                        <span class="stat-unit">grupos</span>
                    </div>
                </div>
                
                <!-- SEPARADOR 1 - Entre Total e Ativos -->
                <div class="stats-separator"></div>
                
                <div class="stat-item" id="statActive">
                    <span class="stat-icon">‚úÖ</span>
                    <div class="stat-info">
                        <span class="stat-label">Ativos:</span>
                        <span class="stat-value">0</span>
                    </div>
                </div>
                
                <!-- SEPARADOR 2 - Entre Ativos e Arquivados -->
                <div class="stats-separator"></div>
                
                <div class="stat-item" id="statArchived">
                    <span class="stat-icon">üì¶</span>
                    <div class="stat-info">
                        <span class="stat-label">Arquivados:</span>
                        <span class="stat-value">0</span>
                    </div>
                </div>
            </div>

            <!-- Filtros por abas -->
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">
                    <span class="tab-icon">üìã</span> Todos
                </button>
                <button class="filter-tab" data-filter="active">
                    <span class="tab-icon">üí¨</span> Ativos
                </button>
                <button class="filter-tab" data-filter="archived">
                    <span class="tab-icon">üì¶</span> Arquivados
                </button>
            </div>

            <!-- Campo de busca -->
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input 
                    type="text" 
                    id="searchGroups" 
                    placeholder="Filtrar grupos..." 
                    autocomplete="off" 
                />
            </div>

            <!-- Lista de grupos (Virtual Scroll) -->
            <div id="groupsList" class="groups-list">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando grupos...</p>
                </div>
            </div>

            <!-- A√ß√µes -->
            <div class="actions">
                <button id="btnBack" class="btn btn-secondary">
                    ‚Üê Voltar
                </button>
                <button id="btnExtract" class="btn btn-primary" disabled>
                    <span class="btn-icon">üì•</span>
                    Extrair Membros
                </button>
            </div>
        </section>

        <!-- ========================================
             ETAPA 3: RESULTADO
        ======================================== -->
        <section id="step3" class="step hidden">
            <div class="result-header">
                <span class="result-icon">‚úÖ</span>
                <h2>Extra√ß√£o Conclu√≠da!</h2>
            </div>

            <!-- Informa√ß√µes do resultado -->
            <div class="result-info">
                <div class="result-item">
                    <span class="label">Grupo:</span>
                    <span id="resultGroupName" class="value">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Status:</span>
                    <span id="resultGroupStatus" class="value">-</span>
                </div>
                <div class="result-item">
                    <span class="label">Membros:</span>
                    <span id="resultMemberCount" class="value">-</span>
                </div>
            </div>

            <!-- Lista de membros extra√≠dos (Virtual Scroll) -->
            <div class="members-container">
                <h3 class="members-title">
                    <span class="members-icon">üë•</span>
                    Membros Extra√≠dos
                </h3>
                <div id="membersList" class="members-list">
                    <!-- Membros ser√£o inseridos aqui via Virtual Scroll -->
                </div>
            </div>

            <!-- Bot√µes de exporta√ß√£o -->
            <div class="export-buttons">
                <button id="btnExportCSV" class="btn btn-export" title="Exportar como CSV (Ctrl+S)">
                    üìÑ CSV
                </button>
                <button id="btnCopyList" class="btn btn-export" title="Copiar lista">
                    üìã Copiar
                </button>
            </div>

            <!-- Bot√µes Google Sheets -->
            <div class="sheets-buttons">
                <button id="btnCopySheets" class="btn btn-sheets" title="Copiar para Google Sheets (Ctrl+G)">
                    <span class="btn-icon">üìä</span> Copiar para Sheets
                </button>
                <button id="btnOpenSheets" class="btn btn-sheets-outline" title="Abrir no Google Sheets">
                    <span class="btn-icon">üîó</span> Abrir no Sheets
                </button>
            </div>

            <!-- Bot√£o nova extra√ß√£o -->
            <button id="btnNewExtraction" class="btn btn-secondary btn-large">
                üîÑ Nova Extra√ß√£o
            </button>
        </section>

        <!-- ========================================
             ETAPA 4: HIST√ìRICO
        ======================================== -->
        <section id="step4" class="step hidden">
            <div class="history-header">
                <h2>üìú Hist√≥rico de Extra√ß√µes</h2>
            </div>

            <!-- Estat√≠sticas do hist√≥rico -->
            <div id="historyStats" class="history-stats">
                <!-- Stats ser√£o inseridas dinamicamente -->
            </div>

            <!-- Lista do hist√≥rico -->
            <div id="historyList" class="history-list">
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Carregando hist√≥rico...</p>
                </div>
            </div>

            <!-- A√ß√µes do hist√≥rico -->
            <div class="actions">
                <button id="btnBackFromHistory" class="btn btn-secondary">
                    ‚Üê Voltar
                </button>
                <button id="btnClearHistory" class="btn btn-danger">
                    üóëÔ∏è Limpar Tudo
                </button>
            </div>
        </section>

        <!-- ========================================
             ETAPA 5: ENVIO EM MASSA
        ======================================== -->
        <section id="step5" class="step hidden">
            <div class="campaign-header">
                <h2>üì¢ Envio em Massa</h2>
            </div>

            <!-- Input de N√∫meros -->
            <div class="campaign-section">
                <label class="campaign-label">
                    <span class="label-icon">üì±</span>
                    N√∫meros (um por linha)
                </label>
                <textarea 
                    id="campaignNumbers" 
                    class="campaign-textarea" 
                    placeholder="5511999998888&#10;5511888887777&#10;..."
                    rows="5"
                ></textarea>
                <div class="campaign-actions-row">
                    <button id="btnImportCSV" class="btn-secondary btn-small">
                        üìÇ Importar CSV
                    </button>
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;" />
                </div>
            </div>

            <!-- Mensagem Template -->
            <div class="campaign-section">
                <label class="campaign-label">
                    <span class="label-icon">üí¨</span>
                    Mensagem
                    <span class="label-hint">(use {{nome}}, {{first_name}}, {{phone}})</span>
                </label>
                <div class="message-input-wrapper">
                    <textarea 
                        id="campaignMessage" 
                        class="campaign-textarea" 
                        placeholder="Ol√° {{first_name}}! üëã&#10;&#10;Sua mensagem aqui..."
                        rows="4"
                    ></textarea>
                    <button id="btnEmojiPicker" class="btn-emoji" title="Adicionar emoji">
                        üòä
                    </button>
                </div>
            </div>

            <!-- Anexar Imagem -->
            <div class="campaign-section">
                <label class="campaign-label">
                    <span class="label-icon">üñºÔ∏è</span>
                    Imagem (opcional)
                </label>
                <div class="image-upload-area" id="imageUploadArea">
                    <input type="file" id="imageFileInput" accept="image/*" style="display: none;" />
                    <button id="btnAttachImage" class="btn-attach-image">
                        <span class="btn-icon">üìé</span>
                        Anexar Imagem
                    </button>
                    <div id="imagePreview" class="image-preview hidden">
                        <img id="previewImg" src="" alt="Preview" />
                        <button id="btnRemoveImage" class="btn-remove-image" title="Remover imagem">
                            ‚úï
                        </button>
                    </div>
                </div>
            </div>

            <!-- Preview WhatsApp -->
            <div class="campaign-section">
                <label class="campaign-label">
                    <span class="label-icon">üëÅÔ∏è</span>
                    Preview
                </label>
                <div class="whatsapp-preview">
                    <div class="whatsapp-bubble">
                        <div id="previewText" class="bubble-text">
                            Ol√°! üëã
                            
                            Sua mensagem aqui...
                        </div>
                        <div class="bubble-meta">
                            <span class="bubble-time">12:00</span>
                            <span class="bubble-checks">‚úì‚úì</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gerar Fila -->
            <div class="campaign-section">
                <button id="btnGenerateQueue" class="btn btn-primary btn-large">
                    <span class="btn-icon">üìã</span>
                    Gerar Fila
                </button>
            </div>

            <!-- Estat√≠sticas -->
            <div id="campaignStats" class="campaign-stats hidden">
                <div class="stat-card stat-sent">
                    <span class="stat-card-icon">‚úÖ</span>
                    <div class="stat-card-content">
                        <span class="stat-card-label">Enviados</span>
                        <span class="stat-card-value" id="statSent">0</span>
                    </div>
                </div>
                <div class="stat-card stat-failed">
                    <span class="stat-card-icon">‚ùå</span>
                    <div class="stat-card-content">
                        <span class="stat-card-label">Falhas</span>
                        <span class="stat-card-value" id="statFailed">0</span>
                    </div>
                </div>
                <div class="stat-card stat-pending">
                    <span class="stat-card-icon">‚è≥</span>
                    <div class="stat-card-content">
                        <span class="stat-card-label">Pendentes</span>
                        <span class="stat-card-value" id="statPending">0</span>
                    </div>
                </div>
            </div>

            <!-- Barra de Progresso da Campanha -->
            <div id="campaignProgress" class="campaign-progress hidden">
                <div class="progress-bar">
                    <div id="campaignProgressFill" class="progress-fill"></div>
                    <span class="progress-text" id="campaignProgressText">0%</span>
                </div>
                <div class="progress-info">
                    <span id="campaignProgressInfo">Preparando...</span>
                    <span id="campaignTimeEstimate"></span>
                </div>
            </div>

            <!-- Controles da Campanha -->
            <div id="campaignControls" class="campaign-controls hidden">
                <button id="btnStartCampaign" class="btn-campaign btn-campaign-start">
                    ‚ñ∂Ô∏è Iniciar Campanha
                </button>
                <button id="btnPauseCampaign" class="btn-campaign btn-campaign-pause hidden">
                    ‚è∏Ô∏è Pausar
                </button>
                <button id="btnStopCampaign" class="btn-campaign btn-campaign-stop">
                    ‚èπÔ∏è Parar
                </button>
            </div>

            <!-- Fila/Tabela -->
            <div id="campaignQueue" class="campaign-queue hidden">
                <div class="queue-header">
                    <h3>Fila de Envio</h3>
                    <div class="queue-actions">
                        <button id="btnSkipCurrent" class="btn-queue-action" title="Pular atual">
                            ‚è≠Ô∏è
                        </button>
                        <button id="btnClearQueue" class="btn-queue-action" title="Zerar fila">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
                <div class="queue-table-wrapper">
                    <table class="queue-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>N√∫mero</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="queueTableBody">
                            <!-- Itens ser√£o inseridos dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- A√ß√µes -->
            <div class="actions">
                <button id="btnBackFromCampaign" class="btn btn-secondary">
                    ‚Üê Voltar
                </button>
            </div>
        </section>

        <!-- ========================================
             MENSAGEM DE ERRO
        ======================================== -->
        <div id="errorBox" class="error-box hidden">
            <span class="error-icon">‚ö†Ô∏è</span>
            <span id="errorText" class="error-text">Erro desconhecido</span>
            <button id="btnDismissError" class="btn-dismiss" title="Fechar">
                ‚úï
            </button>
        </div>



        <!-- ========================================
             FOOTER
        ======================================== -->
        <footer class="footer">
            <span class="footer-text">
                WhatsApp Group Member Extractor
            </span>
        </footer>
    </div>

    <!-- ========================================
         SCRIPTS - SEM type="module"
    ======================================== -->
    <script src="utils/utils-optimized.js"></script>
    <script src="utils/storage.js"></script>
    <script src="utils/google-sheets-export.js"></script>
    <script src="sidepanel.js"></script>
</body>
</html>
